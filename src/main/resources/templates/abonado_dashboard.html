<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <title>Mi área - Abonado</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body{margin:0; background:#f5f6fa; font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif; color:#111;}
        header{background:#2E7D32; color:#fff; padding:14px 18px}
        a{color:inherit; text-decoration:none}
        .container{max-width:1100px; margin:20px auto; padding:0 16px; display:grid; grid-template-columns:1fr 1fr; gap:20px}
        .card{background:#fff; border-radius:12px; padding:18px; box-shadow:0 8px 24px rgba(0,0,0,.08)}
        .title{margin:0 0 10px}
        .btn{display:inline-block; padding:8px 12px; background:#2E7D32; color:#fff; border-radius:10px; border:none; cursor:pointer}
        table{width:100%; border-collapse:collapse}
        th,td{padding:10px; border-bottom:1px solid #e9ecef; text-align:left}
        .tag{display:inline-block; padding:4px 8px; border-radius:999px; font-size:12px}
        .tag.ok{background:#d1e7dd; color:#0f5132}
        .tag.warn{background:#fff3cd; color:#664d03}
        .muted{color:#6c757d}
        @media (max-width:900px){ .container{grid-template-columns:1fr} }
        .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
        input{width:100%; padding:9px; border:1px solid #ced4da; border-radius:8px; box-sizing:border-box; max-width:100%}
    </style>
</head>
<body>
<header>
    <div style="display:flex; align-items:center; justify-content:space-between;">
        <div><a href="/">Peña Bética</a></div>
        <nav><a href="/logout" style="text-decoration:underline">Salir</a></nav>
    </div>
</header>

<div class="container">
    <div class="card">
        <h3 class="title">Mis pases de autobús</h3>
        <form th:action="@{'/abonado/passes/new'}" method="post" style="margin:0 0 10px 0">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <button class="btn" type="submit">Solicitar nuevo pase</button>
        </form>
        <table>
            <thead><tr><th>Código</th><th>Usos restantes</th><th>Estado</th><th>Creado</th></tr></thead>
            <tbody>
            <tr th:each="p : ${passes}">
                <td th:text="${p.code}">ABC-123</td>
                <td><span class="tag" th:classappend="${p.remainingUses} > 0 ? ' ok' : ' warn'"
                          th:text="${p.remainingUses}">3</span></td>
                <td><span th:text="${p.active} ? 'Activo' : 'Inactivo'">Activo</span></td>
                <td class="muted" th:text="${#temporals.format(p.createdAt, 'dd/MM/yyyy HH:mm')}">01/06/2025</td>
            </tr>
            <tr th:if="${#lists.isEmpty(passes)}"><td colspan="4" class="muted">No tienes pases aún.</td></tr>
            </tbody>
        </table>
    </div>

    <div class="card">
        <h3 class="title">Mis cuotas</h3>
        <table>
            <thead><tr><th>Mes</th><th>Importe</th><th>Estado</th><th>Acciones</th></tr></thead>
            <tbody>
            <tr th:each="f : ${fees}">
                <td th:text="${#numbers.formatInteger(f.month,2)} + '/' + ${f.year}">06/2025</td>
                <td th:text="${#numbers.formatDecimal(f.amount,1,2)} + ' €'">10,00 €</td>
                <td>
                    <span class="tag" th:classappend="${f.paid} ? ' ok' : ' warn'"
                          th:text="${f.paid} ? 'Pagada' : 'Pendiente'">Pendiente</span>
                </td>
                <td>
                    <form th:if="${!f.paid and f.forCurrentMonth()}" th:action="@{'/abonado/fees/' + ${f.id} + '/pay'}" method="post" style="margin:0">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                        <button class="btn" type="submit">Pagar</button>
                    </form>
                </td>
            </tr>
            <tr th:if="${#lists.isEmpty(fees)}"><td colspan="4" class="muted">Sin cuotas registradas.</td></tr>
            </tbody>
        </table>
        <p class="muted" style="margin-top:10px">Nota: El pago queda registrado internamente; la verificación final corresponde al área administrativa.</p>
    </div>

    <div class="card" th:if="${member != null}">
        <h3 class="title">Mis datos de contacto</h3>
        <form th:action="@{'/abonado/profile'}" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <div class="row">
                <div>
                    <label>Teléfono</label>
                    <input name="phone" th:value="${member.phone}">
                </div>
                <div>
                    <label>Email</label>
                    <input name="email" type="email" th:value="${member.email}">
                </div>
            </div>
            <p class="muted">Si cambias el email, será necesario volver a verificarlo.</p>
            <button class="btn" type="submit">Guardar</button>
        </form>
    </div>
</div>
</body>
</html>
